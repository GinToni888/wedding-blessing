<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>婚禮線上祝福</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f9f4f4; display: flex; justify-content: center; }
        .card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
        h2 { color: #d63384; text-align: center; margin-bottom: 25px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #666; font-size: 14px; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 8px; box-sizing: border-box; background-color: #fdfdfd; }
        input[readonly] { background-color: #f5f5f5; color: #888; cursor: not-allowed; }
        button { width: 100%; padding: 15px; background-color: #d63384; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        button:active { background-color: #b02a6a; }
        #loading { text-align: center; color: #d63384; }
    </style>
</head>
<body>
    <div class="card" id="form-container" style="display:none;">
        <h2>送上祝福</h2>
        <div class="input-group">
            <label>您的 LINE 暱稱</label>
            <input type="text" id="name" readonly>
        </div>
        <div class="input-group">
            <label>想對新人說的話</label>
            <textarea id="message" rows="5" placeholder="在此輸入您的祝福..." required></textarea>
        </div>
        <button onclick="sendBlessing()">送出祝福</button>
    </div>
    
    <div id="loading">載入中，請稍候...</div>

    <script>
        const liffId = "2008922628-n0ex971B"; // 填入你的 LIFF ID
        const gasUrl = "https://script.google.com/macros/s/AKfycby-P94fg0kooAipQFNCgBejG2EFx0JDT-8gC0A6mlEwISuEyUpyqBJk6XTrAR7FXGcWvQ/exec"; // 填入你的 GAS 網址

        // 初始化 LIFF
        async function main() {
            try {
                await liff.init({ liffId: liffId });
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    const profile = await liff.getProfile();
                    document.getElementById('name').value = profile.displayName;
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('form-container').style.display = 'block';
                }
            } catch (err) {
                console.error("LIFF 初始化失敗", err);
            }
        }

        async function sendBlessing() {
            const name = document.getElementById('name').value;
            const message = document.getElementById('message').value;

            if (!message) return alert("請輸入祝福語內容");

            // 顯示傳送中狀態
            const btn = document.querySelector('button');
            btn.innerText = "傳送中...";
            btn.disabled = true;

            try {
                const response = await fetch(gasUrl, {
                    method: "POST",
                    body: JSON.stringify({ name: name, message: message })
                });

                if (response.ok) {
                    alert("祝福已收到！謝謝你 " + name);
                    liff.closeWindow(); // 成功後自動關閉視窗
                } else {
                    throw new Error("API 回應錯誤");
                }
            } catch (err) {
                alert("傳送失敗，請稍後再試");
                btn.innerText = "重新送出";
                btn.disabled = false;
            }
        }

        main();
    </script>
</body>
</html>
