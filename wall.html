<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Maggie & Stanley Wedding Wall</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:italic,wght@0,700&display=swap" rel="stylesheet">
    <style>
        :root {
            --cream-bg: #fdfaf5;
            --sage-green: #8da086;
            --gold: #c5a059;
            --text-color: #555;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background-color: var(--cream-bg);
            /* ä»¿å®‹å­—å‹è¨­å®š */
            font-family: "STFangsong", "FangSong", "ä»¿å®‹", "Adobe Fangsong", serif;
            -webkit-font-smoothing: antialiased;
        }

        .background {
            position: fixed; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #ffffff 0%, #fdf5e6 100%);
            z-index: -2;
        }

        /* å¼·åŒ–ç¶ æ¤èƒŒæ™¯é¡¯ç¤º */
        .leaf { 
            position: absolute; fill: var(--sage-green); opacity: 0.25; z-index: -1; 
            display: block !important; /* ç¢ºä¿é¡¯ç¤º */
        }
        .top-left { top: -40px; left: -40px; width: 500px; transform: rotate(-5deg); }
        .bottom-right { bottom: -40px; right: -40px; width: 550px; transform: rotate(175deg); }

        #display-container {
            display: flex; justify-content: center; align-items: center;
            height: 100vh; width: 100vw;
        }

        .message-card {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.9);
            border-radius: 45px;
            padding: 70px 90px;
            /* å­—å¡å¯¬åº¦èª¿æ•´ï¼šç¢ºä¿ä¸€è¡Œèƒ½æ”¾å¾—ä¸‹ä¸”æœ‰é¤˜è£• */
            width: 750px; 
            max-width: 85%;
            text-align: center;
            box-shadow: 0 30px 60px rgba(125, 140, 120, 0.08);
            transition: opacity 1s ease-in-out;
        }

        .sender {
            font-size: 20px; color: var(--sage-green);
            margin-bottom: 35px; letter-spacing: 0.2em;
        }

        .content {
            font-size: 32px; /* ç¸®å°å¾Œçš„å°ºå¯¸ */
            line-height: 1.8; color: var(--text-color);
            margin-bottom: 45px;
            word-break: keep-all;
        }

        .wedding-tag {
            font-family: 'Playfair Display', serif;
            font-style: italic; font-size: 20px; color: var(--gold);
        }

        #status-info {
            position: fixed; bottom: 15px; left: 20px; font-size: 13px; color: #bbb;
            background: rgba(255,255,255,0.6); padding: 5px 10px; border-radius: 5px;
        }
    </style>
</head>
<body tabindex="0"> <div class="background"></div>

    <svg class="leaf top-left" viewBox="0 0 200 200">
        <path d="M50,120 Q30,80 70,40 T130,40 Q170,80 150,120 T50,120" />
        <path d="M20,150 Q0,110 40,70 T100,70 Q140,110 120,150 T20,150" opacity="0.6" />
    </svg>
    <svg class="leaf bottom-right" viewBox="0 0 200 200">
        <path d="M50,120 Q30,80 70,40 T130,40 Q170,80 150,120 T50,120" />
        <path d="M60,160 Q40,120 80,80 T140,80 Q180,120 160,160 T60,160" opacity="0.6" />
    </svg>

    <div id="display-container">
        <div id="card-target">
            <div class="message-card">
                <div class="sender">Maggie & Stanley</div>
                <div class="content">è«‹é»æ“Šç•«é¢ä»»ä½•è™•å•Ÿå‹•ç³»çµ±<br>é€£ç·šæˆåŠŸå¾Œå°‡è‡ªå‹•é–‹å§‹è¼ªæ’­</div>
                <div class="wedding-tag">April 2026 @ Mandarin Oriental</div>
            </div>
        </div>
    </div>

    <div id="status-info">ç³»çµ±å•Ÿå‹•ä¸­...</div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    // --- è¨­å®šå€ ---
const gasUrl = "ä½ çš„_GAS_éƒ¨ç½²ç¶²å€"; 

let messages = []; // åˆå§‹è¨­ç‚ºç©ºï¼Œç­‰å¾…æŠ“å–
let currentIndex = 0;
const statusInfo = document.getElementById('status-info');
const container = document.getElementById('card-target');

// 1. å¼·åŒ–æŠ“å–é‚è¼¯ (åŠ å…¥é˜²å¿«å–åƒæ•¸)
async function fetchMessages() {
    try {
        // åœ¨ç¶²å€å¾Œé¢åŠ ä¸Šæ™‚é–“æˆ³è¨˜ï¼Œå¼·è¿«ç€è¦½å™¨æ¯æ¬¡éƒ½æŠ“æœ€æ–°çš„è³‡æ–™
        const timestamp = new Date().getTime();
        const response = await fetch(`${gasUrl}?t=${timestamp}`);
        
        if (!response.ok) throw new Error("ç¶²è·¯å›æ‡‰ä¸æ­£å¸¸");
        
        const data = await response.json();
        
        if (data && data.length > 0) {
            messages = data;
            statusInfo.innerText = "âœ… åŒæ­¥æˆåŠŸï¼šå…± " + data.length + " å‰‡ç¥ç¦ (æœ€å¾Œæ›´æ–°: " + new Date().toLocaleTimeString() + ")";
            
            // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æŠ“åˆ°è³‡æ–™ï¼Œç«‹åˆ»é¡¯ç¤ºç¬¬ä¸€å‰‡ï¼Œä¸è¦è®“è¢å¹•ç­‰
            if (container.innerText.includes("è«‹é»æ“Š") || container.innerText.includes("æ­¡è¿")) {
                rotateMessage();
            }
        } else {
            statusInfo.innerText = "ğŸ“­ è³‡æ–™åº«ç›®å‰æ²’æœ‰ 'ok' çš„è¨Šæ¯";
        }
    } catch (err) {
        statusInfo.innerText = "âŒ é€£ç·šå¤±æ•—ï¼š" + err.message;
        console.error("Fetch Error:", err);
    }
}

// 2. è¼ªæ’­é‚è¼¯
function rotateMessage() {
    if (messages.length === 0) return;

    const data = messages[currentIndex];
    container.style.opacity = 0;
    
    setTimeout(() => {
        // æ¸²æŸ“æ–°å¡ç‰‡ï¼Œä¸¦å°‡ \n æ›æˆæ›è¡Œç¬¦è™Ÿ
        container.innerHTML = `
            <div class="message-card">
                <div class="sender">â€” ${data.name} â€”</div>
                <div class="content">${data.msg.replace(/\n/g, '<br>')}</div>
                <div class="wedding-tag">M & S Forever Love</div>
            </div>
        `;
        container.style.opacity = 1;
        
        // åˆ‡æ›ç´¢å¼•
        currentIndex = (currentIndex + 1) % messages.length;
    }, 1000);
}

// 3. éµç›¤ç›£è½èˆ‡ç„¦é» (é‡å° Safari/Chrome å„ªåŒ–)
document.addEventListener('click', () => {
    window.focus();
    statusInfo.innerText = "ğŸ¯ è¦–çª—å·²å°±ç·’ï¼Œå¯ä½¿ç”¨ç©ºç™½éµ";
});

document.addEventListener('keydown', (e) => {
    // æ”¯æ´ Space èˆ‡ Enterï¼Œå¢åŠ æ“ä½œå®¹éŒ¯ç‡
    if (e.code === 'Space' || e.keyCode === 32 || e.code === 'Enter') {
        e.preventDefault();
        triggerKagamiBiraki();
    }
});

function triggerKagamiBiraki() {
    if (typeof confetti !== 'undefined') {
        confetti({
            particleCount: 180,
            spread: 80,
            origin: { y: 0.65 },
            colors: ['#fdf5e6', '#8da086', '#c5a059', '#ffffff'],
            zIndex: 999
        });
        statusInfo.innerText = "âœ¨ é¡é–‹å„€å¼è§¸ç™¼æˆåŠŸï¼";
    }
}

// --- å•Ÿå‹•èˆ‡å¾ªç’° ---
fetchMessages(); // ç«‹å³æŠ“å–ç¬¬ä¸€æ¬¡
setInterval(fetchMessages, 15000); // æ¯ 15 ç§’æª¢æŸ¥ä¸€æ¬¡è©¦ç®—è¡¨æ˜¯å¦æœ‰æ–° ok è³‡æ–™
setInterval(rotateMessage, 8000);   // æ¯ 8 ç§’åˆ‡æ›ä¸€æ¬¡é¡¯ç¤ºç•«é¢çš„ç¥ç¦èª
</body>
</html>
