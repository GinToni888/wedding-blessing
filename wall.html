<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Maggie & Stanley Wedding Wall</title>
    <style>
        /* 基礎設定 */
        :root {
            --cream-bg: #fdfaf5;
            --sage-green: #8da086;
            --gold: #c5a059;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: var(--cream-bg);
            font-family: "Microsoft JhengHei", "STFangsong", serif;
            overflow: hidden;
        }

        /* 奶油色底色 */
        .background {
            position: fixed; width: 100%; height: 100%;
            background: linear-gradient(135deg, #ffffff 0%, #fdf5e6 100%);
            z-index: -10;
        }

        /* --- 綠植：改用純 CSS 圓形繪製 --- */
        .leaf-box {
            position: fixed;
            background-color: var(--sage-green);
            border-radius: 50% 0 50% 0; /* 葉子形狀 */
            opacity: 0.4;
            filter: blur(8px);
            z-index: -1;
            animation: sway 10s ease-in-out infinite;
        }

        /* 左上角三片葉子 */
        .l1 { width: 300px; height: 200px; top: -50px; left: -50px; }
        .l2 { width: 250px; height: 150px; top: 50px; left: -100px; animation-delay: -2s; opacity: 0.3; }
        
        /* 右下角三片葉子 */
        .l3 { width: 350px; height: 250px; bottom: -80px; right: -50px; transform: rotate(180deg); }
        .l4 { width: 200px; height: 180px; bottom: 50px; right: -80px; animation-delay: -4s; opacity: 0.2; }

        @keyframes sway {
            0%, 100% { transform: translate(0,0) rotate(0deg); }
            50% { transform: translate(20px, 10px) rotate(5deg); }
        }

        /* --- 字卡：確保寬度 --- */
        #display-container {
            display: flex; justify-content: center; align-items: center;
            height: 100vh;
        }

        .message-card {
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid white;
            border-radius: 50px;
            padding: 60px 80px;
            width: 900px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.05);
            transition: opacity 0.8s;
        }

        .sender { font-size: 24px; color: var(--sage-green); margin-bottom: 20px; }
        .content { font-size: 36px; color: #444; line-height: 1.6; }

        /* 狀態偵測列 */
        #debug-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(0,0,0,0.5); color: white;
            font-size: 12px; padding: 5px 15px; z-index: 999;
        }
    </style>
</head>
<body>

    <div class="background"></div>
    
    <div class="leaf-box l1"></div>
    <div class="leaf-box l2"></div>
    <div class="leaf-box l3"></div>
    <div class="leaf-box l4"></div>

    <div id="display-container">
        <div id="card-target">
            <div class="message-card">
                <div class="sender">SYSTEM</div>
                <div class="content">正在連線資料庫...<br>請確認是否已點擊過畫面</div>
            </div>
        </div>
    </div>

    <div id="debug-bar">初始化中...</div>

    <script>
        const gasUrl = "https://script.google.com/macros/s/AKfycby-P94fg0kooAipQFNCgBejG2EFx0JDT-8gC0A6mlEwISuEyUpyqBJk6XTrAR7FXGcWvQ/exec"; // <--- 請務必貼上正確的 exec 網址
        let messages = [];
        let currentIndex = 0;
        const debugBar = document.getElementById('debug-bar');

        async function loadData() {
            debugBar.innerText = "正在連線 GAS: " + gasUrl;
            try {
                const res = await fetch(gasUrl + "?t=" + Date.now());
                const data = await res.json();
                if (data && data.length > 0) {
                    messages = data;
                    debugBar.innerText = "✅ 同步成功！抓到 " + data.length + " 則祝福";
                    showNext();
                } else {
                    debugBar.innerText = "⚠️ 連線成功但沒有資料 (D 欄是否有 ok?)";
                }
            } catch (e) {
                debugBar.innerText = "❌ 連線失敗: " + e.message;
                // 如果失敗，8秒後重試
                setTimeout(loadData, 8000);
            }
        }

        function showNext() {
            if (messages.length === 0) return;
            const card = document.getElementById('card-target');
            const item = messages[currentIndex];
            
            card.style.opacity = 0;
            setTimeout(() => {
                card.innerHTML = `
                    <div class="message-card">
                        <div class="sender">— ${item.name} —</div>
                        <div class="content">${item.msg.replace(/\n/g, '<br>')}</div>
                    </div>
                `;
                card.style.opacity = 1;
                currentIndex = (currentIndex + 1) % messages.length;
            }, 800);
        }

        // 啟動
        loadData();
        setInterval(showNext, 8000);
        setInterval(loadData, 30000); // 30秒抓一次新資料

        // 簡單的點擊測試
        window.onclick = () => { debugBar.innerText += " | 畫面已點擊"; };
    </script>
</body>
</html>
