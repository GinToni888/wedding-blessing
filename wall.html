<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maggie & Stanley Wedding Blessing Wall</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            --bg-cream: #fdfaf5; /* å¥¶æ²¹è‰²åº• */
            --glass-white: rgba(255, 255, 255, 0.75); /* ç£¨ç ‚ç»ç’ƒé€æ˜åº¦ */
            --sage-green: #7a8a66; /* é¼ å°¾è‰ç¶  (æ¨™é¡Œç”¨) */
        }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: var(--bg-cream);
            overflow: hidden;
            /* ä½¿ç”¨ä»¿å®‹é«”ä¸¦è¨­å®šåŸºæœ¬æ¸²æŸ“å„ªåŒ– */
            font-family: "STSong", "NSimSun", "SimSun", serif;
            -webkit-font-smoothing: antialiased;
        }

        /* --- 1. èƒŒæ™¯èˆ‡ç¶ æ¤åœ–å±¤ --- */
        #bg-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -10;
        }

        .bg-img {
            position: fixed;
            z-index: -5;
            pointer-events: none;
            /* è¼•å¾®å‘¼å¸æ„Ÿ */
            animation: plantBreathe 10s ease-in-out infinite;
        }

        /* æ ¹æ“šæ‚¨æä¾›çš„ Canva è¨­è¨ˆå®šä½ */
        .plant-tl {
            top: -5%; left: -5%;
            width: 48vw; max-width: 900px;
            transform-origin: top left;
        }

        .plant-br {
            bottom: -5%; right: -5%;
            width: 42vw; max-width: 800px;
            transform-origin: bottom right;
            animation-delay: -5s;
        }

        @keyframes plantBreathe {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.8; }
            50% { transform: scale(1.04) rotate(1.5deg); opacity: 1; }
        }

        /* --- 2. ä¸»å…§å®¹å®¹å™¨ --- */
        #app-wrapper {
            position: relative;
            width: 100%; height: 100%;
            perspective: 1200px; /* é–‹å•Ÿ 3D ç©ºé–“æ„Ÿ */
            z-index: 1;
        }

        /* --- 3. ç£¨ç ‚ç»ç’ƒå¡ç‰‡ (çµ•å°å±…ä¸­) --- */
        .blessing-card {
            position: absolute;
            /* é…åˆ GSAP xPercent/yPercent é”æˆå®Œç¾å±…ä¸­ */
            top: 50%; left: 50%;
            width: 650px; 
            padding: 60px 45px;
            
            /* ç£¨ç ‚ç»ç’ƒæè³ªè¨­å®š */
            background: var(--glass-white);
            -webkit-backdrop-filter: blur(20px) saturate(140%);
            backdrop-filter: blur(20px) saturate(140%);
            border: 1.5px solid rgba(255, 255, 255, 0.8);
            border-radius: 35px;
            box-shadow: 0 30px 70px rgba(0, 0, 0, 0.08);
            
            text-align: center;
            opacity: 0; /* åˆå§‹éš±è— */
            transform-style: preserve-3d;
            box-sizing: border-box;
        }

        .card-name {
            font-size: 1.6rem; 
            color: var(--sage-green); 
            margin-bottom: 25px; 
            font-weight: bold; 
            letter-spacing: 0.2em;
        }

        .card-content {
            font-size: 1.15rem; 
            color: #333; 
            line-height: 2; 
            letter-spacing: 0.08em;
            /* ç¸®å°å…©è™Ÿä»¥å±•ç¾çº–ç´°æ„Ÿ */
            transform: scale(0.95);
        }

        /* ç³»çµ±ç‹€æ…‹æç¤ºåˆ— (é™¤éŒ¯ç”¨) */
        #status-bar {
            position: fixed; bottom: 12px; left: 15px;
            font-size: 11px; color: rgba(0,0,0,0.2);
            z-index: 100;
            font-family: sans-serif;
        }
    </style>
</head>
<body>

    <div id="bg-layer"></div>
    <img src="plant-top-left.png" class="bg-img plant-tl" alt="">
    <img src="plant-bottom-right.png" class="bg-img plant-br" alt="">

    <div id="app-wrapper">
        <div id="card-container"></div>
    </div>

    <div id="status-bar">æ­£åœ¨æª¢æŸ¥ç’°å¢ƒè¨­å®š...</div>

    <script>
        // --- è¨­å®šèˆ‡åˆå§‹åŒ– ---
        let messages = [
            { name: "Wedding Team", content: "æ­¡è¿ä¾†åˆ° Maggie & Stanley çš„å©šç¦®ï¼ŒæœŸå¾…èˆ‡å¤§å®¶åœ¨å°åŒ—æ±æ–¹æ–‡è¯ç›¸è¦‹ï¼", status: "ok" }
        ];
        let currentIndex = 0;
        let isLooping = false;
        
        // è«‹ç¢ºä¿æ‚¨çš„ GAS é€£çµå·²ç¶“è¨­å®šç‚ºã€Œæ‰€æœ‰äºº (Anyone)ã€
        const GAS_URL = "https://script.google.com/macros/s/AKfycby-P94fg0kooAipQFNCgBejG2EFx0JDT-8gC0A6mlEwISuEyUpyqBJk6XTrAR7FXGcWvQ/exec";

        async function initSystem() {
            document.getElementById('status-bar').innerText = "æ­£åœ¨è®€å– Google Sheet...";
            await updateData();
            if (!isLooping) startLoop();
        }

        // --- è³‡æ–™åŒæ­¥é‚è¼¯ (å¼·åŒ–è‡ªå‹•è­˜åˆ¥æ¬„ä½) ---
        async function updateData() {
            try {
                const res = await fetch(`${GAS_URL}?t=${Date.now()}`);
                if (!res.ok) throw new Error("GAS è«‹æ±‚å¤±æ•—");
                
                let data = await res.json();
                
                // å¦‚æœè³‡æ–™è¢«åŒ…è£¹åœ¨ data å±¬æ€§ä¸­ï¼Œè‡ªå‹•æ‹†åŒ…
                if (data.data && Array.isArray(data.data)) data = data.data;

                // å¼·åŒ–éæ¿¾å™¨ï¼šåŒæ™‚ç›¸å®¹ã€Œå¯©æ ¸ç‹€æ…‹ã€ã€ã€Œstatusã€èˆ‡ã€ŒStatusã€
                const filtered = data.filter(m => {
                    if (!m) return false;
                    const val = m.status || m.Status || m.å¯©æ ¸ç‹€æ…‹ || m['å¯©æ ¸ç‹€æ…‹'];
                    return val && String(val).toLowerCase().trim() === 'ok';
                });

                if (filtered.length > 0) {
                    messages = filtered;
                    document.getElementById('status-bar').innerText = `åŒæ­¥æˆåŠŸ: å·²æ›´æ–° ${messages.length} å‰‡ç¥ç¦`;
                } else {
                    document.getElementById('status-bar').innerText = "è³‡æ–™åŒæ­¥å®Œæˆï¼Œä½†ç›®å‰æ²’æœ‰æ¨™è¨˜ç‚º ok çš„è¨Šæ¯ã€‚";
                }
            } catch (e) {
                console.error("åŒæ­¥å¤±æ•—:", e);
                document.getElementById('status-bar').innerText = "é€£ç·šå¤±æ•—ï¼Œç›®å‰é¡¯ç¤ºé è¨­ç¥ç¦ã€‚";
            }
        }

        // --- æ ¸å¿ƒè¼ªæ’­å‹•ç•«èˆ‡ç„¡é™å¾ªç’° ---
        function startLoop() {
            if (messages.length === 0) return;
            isLooping = true;
            
            const container = document.getElementById('card-container');
            const data = messages[currentIndex];
            
            // å»ºç«‹å¡ç‰‡å…ƒä»¶
            const card = document.createElement('div');
            card.className = 'blessing-card';
            card.innerHTML = `
                <div class="card-name">${data.name}</div>
                <div class="card-content">${data.content}</div>
            `;
            container.appendChild(card);

            // GSAP 3D å‹•ç•«åºåˆ—
            const tl = gsap.timeline({
                onComplete: () => {
                    card.remove(); // å‹•ç•«çµæŸå¾Œç§»é™¤èˆŠå¡ç‰‡
                    currentIndex = (currentIndex + 1) % messages.length; // ç„¡é™å¾ªç’°ç´¢å¼•
                    startLoop(); // éè¿´ä¸‹ä¸€å¼µ
                }
            });

            // 1. é€²å ´ï¼šå¾æ·±è™•é£›å…¥ä¸¦æ”¾å¤§ (Zoom In)
            tl.fromTo(card, 
                { 
                    opacity: 0, scale: 0.8, z: -200, 
                    xPercent: -50, yPercent: -50, 
                    left: "50%", top: "50%" 
                }, 
                { 
                    opacity: 1, scale: 1, z: 0, 
                    duration: 1.8, ease: "power2.out" 
                }
            )
            // 2. åœç•™ï¼šå±•ç¤º 6 ç§’
            .to(card, { opacity: 1, duration: 6 }) 
            // 3. é€€å ´ï¼šç¸®å°ä¸¦å‘è¢å¹•æ·±è™•é£„å‹• (Shrink & Recede)
            .to(card, { 
                opacity: 0, scale: 0.7, z: -400, 
                duration: 1.5, ease: "power2.in" 
            });
        }

        // --- é¡é–‹å„€å¼ç‰¹æ•ˆ (æŒ‰ä¸‹ç©ºç™½éµè§¸ç™¼) ---
        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                triggerKagamiBiraki();
            }
        });

        function triggerKagamiBiraki() {
            console.log("ğŸ”¨ é¡é–‹å„€å¼è½æ§Œï¼");
            // å™´ç™¼å¥¶æ²¹è‰²èŠ±ç“£èˆ‡é‡‘ç²‰
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#FFFDD0', '#D4AF37', '#E0E5D1'] // å¥¶æ²¹ã€é‡‘ã€é¼ å°¾è‰ç¶ 
            });
        }

        // åˆå§‹åŒ–
        window.onload = initSystem;
        // æ¯ 60 ç§’èƒŒæ™¯æ›´æ–°ä¸€æ¬¡è³‡æ–™ï¼Œä¸ä¸­æ–·ç›®å‰çš„å‹•ç•«
        setInterval(updateData, 60000);

    </script>
</body>
</html>
