<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Maggie & Stanley Wedding Wall</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:italic,wght@0,700&display=swap" rel="stylesheet">
    <style>
        :root {
            --cream-bg: #fdfaf5;
            --sage-green: #8da086;
            --gold: #c5a059;
            --text-color: #555;
        }
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background-color: var(--cream-bg);
            font-family: "STFangsong", "FangSong", "ä»¿å®‹", "Adobe Fangsong", serif;
        }
        .background {
            position: fixed; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #ffffff 0%, #fdf5e6 100%);
            z-index: -2;
        }
        .leaf { position: absolute; fill: var(--sage-green); opacity: 0.25; z-index: -1; }
        .top-left { top: -20px; left: -20px; width: 450px; transform: rotate(-10deg); }
        .bottom-right { bottom: -20px; right: -20px; width: 500px; transform: rotate(170deg); }

        #display-container {
            display: flex; justify-content: center; align-items: center;
            height: 100vh; width: 100vw;
        }
        .message-card {
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            border-radius: 40px; padding: 60px 80px;
            width: 900px; max-width: 85%; text-align: center;
            box-shadow: 0 25px 50px rgba(125, 140, 120, 0.1);
            transition: opacity 1s ease-in-out;
            opacity: 1;
        }
        .sender { font-size: 20px; color: var(--sage-green); margin-bottom: 30px; letter-spacing: 0.15em; }
        .content { font-size: 32px; line-height: 1.8; color: var(--text-color); margin-bottom: 40px; word-break: keep-all; }
        .wedding-tag { font-family: 'Playfair Display', serif; font-style: italic; font-size: 20px; color: var(--gold); }
        
        #status-info {
            position: fixed; bottom: 15px; left: 20px; font-size: 13px; color: #bbb;
            background: rgba(255,255,255,0.7); padding: 5px 12px; border-radius: 20px;
            pointer-events: none; z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="background"></div>
    <svg class="leaf top-left" viewBox="0 0 200 200"><path d="M40,100 Q40,40 100,40 T160,100 Q160,160 100,160 T40,100" /></svg>
    <svg class="leaf bottom-right" viewBox="0 0 200 200"><path d="M40,100 Q40,40 100,40 T160,100 Q160,160 100,160 T40,100" /></svg>

    <div id="display-container">
        <div id="card-target">
            <div class="message-card">
                <div class="sender">Maggie & Stanley</div>
                <div class="content">ç³»çµ±æ­£åœ¨èˆ‡è³‡æ–™åº«é€£ç·šä¸­...<br>è«‹ç¢ºä¿ Google è©¦ç®—è¡¨ D æ¬„å·²å¡«å¯« ok</div>
                <div class="wedding-tag">April 2026 @ Mandarin Oriental</div>
            </div>
        </div>
    </div>

    <div id="status-info">åˆå§‹åŒ–ä¸­...</div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        // --- è«‹ç¢ºèª GAS ç¶²å€æ­£ç¢º ---
        const gasUrl = "ä½ çš„_GAS_éƒ¨ç½²ç¶²å€"; 
        
        let messages = []; 
        let currentIndex = 0;
        const statusInfo = document.getElementById('status-info');
        const cardTarget = document.getElementById('card-target');

        // 1. å¼·åŒ–ç‰ˆæŠ“å–å‡½å¼
        async function fetchMessages() {
            try {
                statusInfo.innerText = "ğŸ“¡ æ­£åœ¨åŒæ­¥è³‡æ–™...";
                // åŠ ä¸Šéš¨æ©Ÿåƒæ•¸é˜²æ­¢å¿«å–
                const response = await fetch(`${gasUrl}?t=${new Date().getTime()}`);
                
                if (!response.ok) throw new Error("é€£ç·šç•°å¸¸");
                
                const data = await response.json();
                
                if (data && data.length > 0) {
                    messages = data;
                    statusInfo.innerText = `âœ… åŒæ­¥æˆåŠŸ: ${data.length} å‰‡ (æœ€å¾Œæ›´æ–°: ${new Date().toLocaleTimeString()})`;
                    
                    // å¦‚æœç›®å‰ç•«é¢é‚„æ˜¯åˆå§‹ç•«é¢ï¼Œå¼·åˆ¶åˆ‡æ›
                    if (cardTarget.innerText.includes("ç³»çµ±æ­£åœ¨") || cardTarget.innerText.includes("æ­¡è¿")) {
                        rotateMessage();
                    }
                } else {
                    statusInfo.innerText = "ğŸ“­ è³‡æ–™åº«ç‚ºç©º (è«‹æª¢æŸ¥ D æ¬„æœ‰ç„¡ ok)";
                }
            } catch (err) {
                statusInfo.innerText = "âŒ é€£ç·šå¤±æ•—: " + err.message;
                console.error(err);
            }
        }

        // 2. è¼ªæ’­é‚è¼¯
        function rotateMessage() {
            if (messages.length === 0) return;

            const data = messages[currentIndex];
            cardTarget.style.opacity = 0;
            
            setTimeout(() => {
                cardTarget.innerHTML = `
                    <div class="message-card">
                        <div class="sender">â€” ${data.name} â€”</div>
                        <div class="content">${data.msg.replace(/\n/g, '<br>')}</div>
                        <div class="wedding-tag">M & S Forever Love</div>
                    </div>
                `;
                cardTarget.style.opacity = 1;
                currentIndex = (currentIndex + 1) % messages.length;
            }, 1000);
        }

        // 3. è§£æ±ºç©ºç™½éµ
        document.addEventListener('click', () => {
            window.focus();
            statusInfo.innerText = "ğŸ¯ è¦–çª—å·²å°±ç·’ï¼Œå¯ä½¿ç”¨ç©ºç™½éµ";
        });

        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.keyCode === 32) {
                e.preventDefault();
                triggerKagamiBiraki();
            }
        });

        function triggerKagamiBiraki() {
            confetti({
                particleCount: 180, spread: 80, origin: { y: 0.65 },
                colors: ['#fdf5e6', '#8da086', '#c5a059', '#ffffff'],
                zIndex: 999
            });
            statusInfo.innerText = "âœ¨ é¡é–‹å„€å¼è§¸ç™¼æˆåŠŸï¼";
        }

        // å•Ÿå‹•å¾ªç’°
        fetchMessages();
        setInterval(fetchMessages, 20000); // 20ç§’æŠ“ä¸€æ¬¡æ–°è³‡æ–™
        setInterval(rotateMessage, 8000);   // 8ç§’æ›ä¸€å‰‡
    </script>
</body>
</html>
